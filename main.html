<!DOCTYPE html>
<html>
<head>
    <title>Inventory - main</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:white;}
        .header {text-align:center; padding:20px; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
        .container {width:90%; max-width:900px; margin:auto; margin-top:30px; background:white; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
        table {width:100%; border-collapse: collapse; margin-top:20px;}
        th, td {border:1px solid #ccc; padding:8px; text-align:center;}
        th {background: gray;}
        input, select {padding:6px; margin-right:10px;}
        .btn {padding:6px 10px; cursor:pointer; border:none; border-radius:4px;}
        .btn-add, .btn-update {background: green; color:white;}
        .btn-deduct {background: red; color:white;}
        .btn-remove {background: darkred; color:white;}
        .btn-logout {background:black; color:white; float:right;}
        h3 {margin-top:30px;}
    </style>
</head>
<body>

<div class="header">
    <img src="logo.jpg" alt="RBG Logo" width="150">
    <h2>RBG INVENTORY STOCK SYSTEM - MAIN</h2>
    <p>Logged in as: <span id="currentUser"></span></p>
    <button class="btn btn-logout" onclick="logout()">Logout</button>
</div>

<div class="container">

<h3>Add new item</h3>
<label>Item name:</label>
<input type="text" id="newItemName">
<label>Initial Stock:</label>
<input type="number" id="newItemStock" min="0">
<label>Unit:</label>
<select id="newItemUnit">
    <option value="g">grams (g)</option>
    <option value="kg">kilograms (kg)</option>
    <option value="pcs">pieces (pcs)</option>
</select>
<button class="btn btn-add" onclick="addItem()">Add Item</button>

<hr>

<h3>Update stock</h3>
<label>Select item:</label>
<select id="itemSelect"></select>
<label>Quantity:</label>
<input type="number" id="qtyInput" min="1">
<label>Unit:</label>
<select id="updateUnit">
    <option value="g">grams (g)</option>
    <option value="kg">kilograms (kg)</option>
    <option value="pcs">pieces (pcs)</option>
</select>
<button class="btn btn-update" onclick="addStock()">Add Stock</button>
<button class="btn btn-deduct" onclick="deductStock()">Deduct Stock</button>

<hr>

<h3>Inventory list</h3>
<table id="inventoryTable">
    <tr>
        <th>Item Name</th>
        <th>Stock</th>
        <th>Day & Date</th>
        <th>Action</th>
    </tr>
</table>

</div>

<script>
// Redirect if not logged in
if (!sessionStorage.getItem("loggedIn")) { window.location.href="login.html"; }

const currentUser = sessionStorage.getItem("currentUser");
document.getElementById("currentUser").textContent = currentUser;

let inventory = JSON.parse(localStorage.getItem(`inventory_${currentUser}`)) || [];

function refreshDisplay() {
    let select = document.getElementById("itemSelect");
    let table = document.getElementById("inventoryTable");

    select.innerHTML = "";
    table.innerHTML = `<tr>
        <th>Item Name</th><th>Stock</th><th>Day & Date</th><th>Action</th></tr>`;

    inventory.forEach((item, index)=>{
        let opt=document.createElement("option");
        opt.value=index; opt.textContent=`${item.name} (${item.stock}${item.unit})`;
        select.appendChild(opt);

        let row=table.insertRow(-1);
        row.insertCell(0).innerHTML=item.name;
        row.insertCell(1).innerHTML=`${item.stock} ${item.unit}`;
        row.insertCell(2).innerHTML=item.dateDay;
        row.insertCell(3).innerHTML=`<button class="btn btn-remove" onclick="removeItem(${index})">Remove</button>`;
    });

    localStorage.setItem(`inventory_${currentUser}`, JSON.stringify(inventory));
}

function getDateDay(){
    const now=new Date();
    const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    let day=days[now.getDay()];
    let date=now.toLocaleDateString("en-US",{month:"long", day:"numeric", year:"numeric"});
    return `${day}, ${date}`;
}

function addItem(){
    let name=document.getElementById("newItemName").value.trim();
    let stock=parseFloat(document.getElementById("newItemStock").value);
    let unit=document.getElementById("newItemUnit").value;

    if(name=="" || isNaN(stock) || stock<0){alert("Enter valid name and stock"); return;}
    inventory.push({name, stock, unit, dateDay:getDateDay()});
    refreshDisplay();
    document.getElementById("newItemName").value="";
    document.getElementById("newItemStock").value="";
}

function addStock(){
    let index=document.getElementById("itemSelect").value;
    let qty=parseFloat(document.getElementById("qtyInput").value);
    let unit=document.getElementById("updateUnit").value;
    if(index==""||isNaN(qty)||qty<=0){alert("Choose item and quantity"); return;}
    if(inventory[index].unit!==unit){alert(`Unit mismatch! Item uses ${inventory[index].unit}`); return;}
    inventory[index].stock+=qty;
    inventory[index].dateDay=getDateDay();
    refreshDisplay(); document.getElementById("qtyInput").value="";
}

function deductStock(){
    let index=document.getElementById("itemSelect").value;
    let qty=parseFloat(document.getElementById("qtyInput").value);
    let unit=document.getElementById("updateUnit").value;
    if(index==""||isNaN(qty)||qty<=0){alert("Choose item and quantity"); return;}
    if(inventory[index].unit!==unit){alert(`Unit mismatch! Item uses ${inventory[index].unit}`); return;}
    if(qty>inventory[index].stock){alert("Not enough stock"); return;}
    inventory[index].stock-=qty;
    inventory[index].dateDay=getDateDay();
    refreshDisplay(); document.getElementById("qtyInput").value="";
}

function removeItem(index){
    if(confirm(`Remove ${inventory[index].name}?`)){
        inventory.splice(index,1); refreshDisplay();
    }
}

function logout(){
    sessionStorage.removeItem("loggedIn");
    sessionStorage.removeItem("currentUser");
    window.location.href="login.html";
}

refreshDisplay();
</script>

</body>
</html>
